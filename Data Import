from datetime import datetime
import numpy as np
import matplotlib.pylab as plt
import os
import sys

now = datetime.now()
dt_string = now.strftime("%d/%m/%Y %H:%M:%S")
print("Starting at",dt_string)

filename = "/Users/rolandg/CW_Data/20220413/Det1_20220413.txt"


#Check if file exists
flag = os.path.exists(filename)   
if flag : 
    print(filename, "found")
else:
    print(filename, "does not exist")
    sys.exit()


print("Open ", filename)
                
f = open(filename,"r")

# read and discard header lines
print("Read seven line CosmicWatch file header")
for i in range(7):
    s = f.readline()

#adjust nevent if you don't want to read whole file
nevent = 10000000
print("Read ",nevent," events from CosmicWatch data")
timestamps = []

#the while loop will run until the end of file or i == nevent
flag = True
i = 0
while flag:
    s = f.readline()
    if s:
        ss = s.split()
        timestamps.append(float(ss[3]))
        if i%10000 == 0:
            print(i,":", timestamps[i])
        i = i + 1
        if i == nevent:
            flag = False
    else:
# reached end of file; stop while loop
        flag = False
        
print("Total events read = ",i)

nevent = i

nbins =100

xmin = 0
xmax =1000000000

plt.hist(timestamps,nbins,histtype='step',range=[xmin,xmax])
plt.ylabel(r'No of events/bin', fontsize = 18)
plt.xlabel(r'time (microseconds)', fontsize = 18)
plt.tight_layout()         # Automatically set the margins to fit everything
plt.savefig("myplot.pdf")
plt.show()

now = datetime.now()
dt_string = now.strftime("%d/%m/%Y %H:%M:%S")
print("Done at",dt_string)
